<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
<title>Real time chat with node js and socket io</title>
</head>

<body>
	<div class="w3-row w3-margin">
		<div class="w3-container w3-quarter"></div>
		<div class="w3-card-12 w3-white w3-half">
			<header class="w3-container w3-green">
				<h1>Real time chat</h1>
			</header>
			<div class="w3-container w3-white" id="content" style="overflow: auto;">
				<ul id="messages" style="height: 350px;"></ul>		
			</div>
			<hr />
			<footer class="w3-container w3-margin" >
				<div>
					<input type="text" id="username" style="width: 40%; height: 34px; margin-bottom: 5px; clear: right;"
						placeholder="Your name">
					<textarea id="inputMsg" style="width: 100%; height: 50px; float: left; resize: none;"
						placeholder="Type a message..."></textarea>
					<!-- <button class="w3-btn w3-green" style="width: 20%; float: right;" id="send">Send</button> -->
				</div>
			</footer>
		</div>
		<div class="w3-container w3-quarter"></div>
	</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
	$(function () {
		var messages = [];
		var socket = io.connect('http://localhost:3001');
		socket.on('message', function (data) {
			data && data.username && $("#messages").append("<li><b>"+data.username+": </b>"+data.message+"</li>") || console.log(data);
		});
	 		
		$('#inputMsg').keypress(function(event){
			var keycode = (event.keyCode ? event.keyCode : event.which);
			
			if(keycode == '13'){
				//allow Shift+Enter to return line
				if(!event.shiftKey){
					var msg = $("#inputMsg").val().trim();
					(msg != '') && sendButtonClick(msg) && $("#content").scrollTop($("#content")[0].scrollHeight);
				}
			}
			
		});
		
		function sendButtonClick(msg) {
			var username = $("#username").val();
			if(!username){
				alert("Please enter your name!");
			}
			else {
				socket.emit('send', { message: msg, username: username });
				$("#inputMsg").val('');
			}
		};
	});
</script>

<body>

</html>